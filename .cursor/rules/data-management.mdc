---
description: "Data management and processing guidelines for the cancer probability calculator"
---

# ğŸ“Š Data Management Guide

## ğŸ—‚ï¸ Data File Organization

### Core Data Files
- [cancer-data.js](mdc:cancer-data.js) - Main cancer incidence data (1,400+ lines)
- [death-data.js](mdc:death-data.js) - Death cause statistics
- [life-table-data.js](mdc:life-table-data.js) - Simplified life table data
- [complete-life-table-data.js](mdc:complete-life-table-data.js) - Complete life expectancy data

### Source Data Files
- `24ê°œ_ì•”ì¢…_ì„±_ì—°ë ¹_5ì„¸_ë³„_ì•”ë°œìƒììˆ˜__ë°œìƒë¥ _*.xlsx` - Cancer incidence source
- `ì‚¬ë§ì›ì¸ìƒëª…í‘œ_5ì„¸ë³„__*.xlsx` - Death cause source
- `ì™„ì „ìƒëª…í‘œ_1ì„¸ë³„__*.xlsx` - Complete life table source

## ğŸ“‹ Data Structure Standards

### Cancer Data Structure
```javascript
const cancerData = {
  "male": {
    "0-19": [
      {
        "name": "ë°±í˜ˆë³‘(C91-C95)",
        "rate": 4.825,           // 2022 incidence rate (per 100,000)
        "average5Year": 4.95     // 5-year average (2018-2022)
      }
    ],
    "20-29": [/* ... */],
    // ... other age groups
  },
  "female": {
    // Same structure for female data
  }
}
```

### Death Data Structure
```javascript
const deathData = {
  "male": {
    "0-19": [
      {
        "name": "3ëŒ€ ì‚¬ì¸",
        "rate": 43.79            // Death rate percentage
      },
      {
        "name": "ì•…ì„± ì‹ ìƒë¬¼(ì•”)",
        "rate": 23.83
      }
      // ... other causes
    ]
  }
}
```

## ğŸ”„ Data Processing Pipeline

### ETL Process
1. **Extract**: Read Excel files from KOSIS
2. **Transform**: Clean, validate, and structure data
3. **Load**: Generate JavaScript data files

### Key Processing Scripts
- [parse_excel_data_final.py](mdc:parse_excel_data_final.py) - Main cancer data parser
- [parse_complete_life_table_final.py](mdc:parse_complete_life_table_final.py) - Life table parser
- [fix_integration.py](mdc:fix_integration.py) - Data integration fixes

## ğŸ¯ Age Group Mapping

### Standard Age Groups
```python
age_groups = {
    '0-19': ['0-4ì„¸', '5-9ì„¸', '10-14ì„¸', '15-19ì„¸'],
    '20-29': ['20-24ì„¸', '25-29ì„¸'],
    '30-39': ['30-34ì„¸', '35-39ì„¸'],
    '40-49': ['40-44ì„¸', '45-49ì„¸'],
    '50-59': ['50-54ì„¸', '55-59ì„¸'],
    '60-69': ['60-64ì„¸', '65-69ì„¸'],
    '70+': ['70-74ì„¸', '75-79ì„¸', '80-84ì„¸', '85ì„¸ì´ìƒ']
}
```

### Gender Mapping
```python
gender_mapping = {
    'ë‚¨ì': 'male',
    'ì—¬ì': 'female'
}
```

## ğŸ” Data Validation Rules

### Required Fields
- **name**: Disease/cause name (string)
- **rate**: Incidence/death rate (number)
- **average5Year**: 5-year average (number, optional)

### Data Quality Checks
```python
def validate_data_item(item):
    """ë°ì´í„° í•­ëª© ìœ íš¨ì„± ê²€ì‚¬"""
    required_fields = ['name', 'rate']
    
    for field in required_fields:
        if field not in item:
            return False, f"Missing field: {field}"
    
    if not isinstance(item['rate'], (int, float)):
        return False, "Rate must be numeric"
    
    if item['rate'] < 0:
        return False, "Rate cannot be negative"
    
    return True, "Valid"
```

## ğŸ“ˆ Data Transformation Rules

### Rate Conversion
```javascript
// Cancer rates: per 100,000 â†’ percentage
function convertToPercentage(rate) {
    return (rate / 100000) * 100;
}

// Death rates: already in percentage, no conversion needed
```

### Data Filtering
```javascript
// Remove unwanted categories
const filteredData = data.filter(item => 
    item.name !== 'ê¸°íƒ€ ì•”(Re. C00-C96)' &&
    item.name !== '3ëŒ€ ì‚¬ì¸' &&
    !item.name.includes('ìˆœí™˜ê³„í†µì˜ ì§ˆí™˜') &&
    !item.name.includes('í˜¸í¡ê³„í†µì˜ ì§ˆí™˜')
);
```

## ğŸ”„ Data Update Process

### Update Workflow
1. **Download**: Get latest Excel files from KOSIS
2. **Backup**: Create backup of current data files
3. **Parse**: Run Python parsing scripts
4. **Validate**: Check data integrity
5. **Test**: Verify web application functionality
6. **Deploy**: Replace old data files

### Update Scripts
```bash
# Main data update
python parse_excel_data_final.py

# Life table update
python parse_complete_life_table_final.py

# Integration and fixes
python fix_integration.py
```

## ğŸ“Š Statistical Calculations

### Cumulative Percentages
```javascript
function calculateCumulativePercentage(data, limit, type) {
    const limitedData = limit === 'all' ? data : data.slice(0, parseInt(limit));
    let cumulative = 0;
    
    return limitedData.map(item => {
        const percentage = type === 'death' ? item.rate : convertToPercentage(item.rate);
        cumulative += percentage;
        
        return {
            ...item,
            percentage: percentage
        };
    });
}
```

### Three Major Causes Calculation
```javascript
function calculateThreeMajorCauses(data) {
    let cancer = 0, pneumonia = 0, cardiovascular = 0;
    
    data.forEach(item => {
        if (item.name === 'ì•…ì„± ì‹ ìƒë¬¼(ì•”)') cancer = item.rate;
        if (item.name === '- íë ´') pneumonia = item.rate;
        if (item.name === '- ì‹¬ì¥ ì§ˆí™˜') cardiovascular = item.rate;
    });
    
    return {
        cancer, pneumonia, cardiovascular,
        total: cancer + pneumonia + cardiovascular
    };
}
```

## ğŸš¨ Data Quality Assurance

### Common Issues
- **Missing Data**: Handle NaN values appropriately
- **Duplicate Entries**: Remove duplicates during processing
- **Inconsistent Naming**: Standardize disease/cause names
- **Data Type Mismatches**: Ensure numeric fields are properly typed

### Quality Checks
```python
def quality_check(df):
    """ë°ì´í„° í’ˆì§ˆ ê²€ì‚¬"""
    issues = []
    
    # Check for missing values
    if df.isnull().any().any():
        issues.append("Missing values detected")
    
    # Check for duplicates
    if df.duplicated().any():
        issues.append("Duplicate rows found")
    
    # Check data types
    numeric_columns = ['rate', 'average5Year']
    for col in numeric_columns:
        if col in df.columns and not pd.api.types.is_numeric_dtype(df[col]):
            issues.append(f"Column {col} is not numeric")
    
    return issues
```

## ğŸ“ Documentation Standards

### Data File Headers
```javascript
// ì•” ë°œìƒë¥  ë°ì´í„° (2022ë…„ + 5ê°œë…„ í‰ê· )
// êµ­ê°€í†µê³„ìë£Œ ê¸°ë°˜
// ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2025ë…„ 9ì›”
// ë°ì´í„° ì¶œì²˜: KOSIS êµ­ê°€í†µê³„í¬í„¸
```

### Update Documentation
- Record update dates in file headers
- Maintain changelog in [DATA_UPDATE_GUIDE.md](mdc:DATA_UPDATE_GUIDE.md)
- Document any data structure changes