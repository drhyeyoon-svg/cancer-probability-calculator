// 완전생명표 데이터 (2023년)
// 국가통계자료 기반 (완전생명표최종본.xlsx)
// 마지막 업데이트: 2025년 9월
// 데이터 출처: KOSIS 국가통계포털
// 2023년 단일 연도 데이터 (1세별 세분화)

const completeLifeTable2023 = {
  "0": {
    "기대여명(전체) (년)": 83.5,
    "기대여명(남자) (년)": 80.6,
    "기대여명(여자) (년)": 86.4,
    "사망확률(전체)": 0.00242,
    "사망확률(남자)": 0.00268,
    "사망확률(여자)": 0.00214,
    "생존자(전체)": 100000.0,
    "생존자(남자)": 100000.0,
    "생존자(여자)": 100000.0
  },
  "1": {
    "기대여명(전체) (년)": 82.7,
    "기대여명(남자) (년)": 79.8,
    "기대여명(여자) (년)": 85.6,
    "사망확률(전체)": 0.00018,
    "사망확률(남자)": 0.00023,
    "사망확률(여자)": 0.00014,
    "생존자(전체)": 99758.0,
    "생존자(남자)": 99732.0,
    "생존자(여자)": 99786.0
  },
  "5": {
    "기대여명(전체) (년)": 78.7,
    "기대여명(남자) (년)": 75.8,
    "기대여명(여자) (년)": 81.6,
    "사망확률(전체)": 0,
    "사망확률(남자)": 0,
    "사망확률(여자)": 0,
    "생존자(전체)": 99703.0,
    "생존자(남자)": 99673.0,
    "생존자(여자)": 99734.0
  },
  "10": {
    "기대여명(전체) (년)": 73.8,
    "기대여명(남자) (년)": 70.9,
    "기대여명(여자) (년)": 76.7,
    "사망확률(전체)": 0,
    "사망확률(남자)": 0,
    "사망확률(여자)": 0,
    "생존자(전체)": 99666.0,
    "생존자(남자)": 99635.0,
    "생존자(여자)": 99699.0
  },
  "15": {
    "기대여명(전체) (년)": 68.8,
    "기대여명(남자) (년)": 65.9,
    "기대여명(여자) (년)": 71.7,
    "사망확률(전체)": 0.00019,
    "사망확률(남자)": 0.0002,
    "사망확률(여자)": 0.00018,
    "생존자(전체)": 99613.0,
    "생존자(남자)": 99582.0,
    "생존자(여자)": 99646.0
  },
  "20": {
    "기대여명(전체) (년)": 63.9,
    "기대여명(남자) (년)": 61.0,
    "기대여명(여자) (년)": 66.8,
    "사망확률(전체)": 0.00031,
    "사망확률(남자)": 0.00038,
    "사망확률(여자)": 0.00024,
    "생존자(전체)": 99495.0,
    "생존자(남자)": 99449.0,
    "생존자(여자)": 99541.0
  },
  "25": {
    "기대여명(전체) (년)": 59.0,
    "기대여명(남자) (년)": 56.1,
    "기대여명(여자) (년)": 61.9,
    "사망확률(전체)": 0.00042,
    "사망확률(남자)": 0.00052,
    "사망확률(여자)": 0.00033,
    "생존자(전체)": 99317.0,
    "생존자(남자)": 99231.0,
    "생존자(여자)": 99403.0
  },
  "30": {
    "기대여명(전체) (년)": 54.1,
    "기대여명(남자) (년)": 51.3,
    "기대여명(여자) (년)": 57.0,
    "사망확률(전체)": 0.00053,
    "사망확률(남자)": 0.00067,
    "사망확률(여자)": 0.00039,
    "생존자(전체)": 99085.0,
    "생존자(남자)": 98934.0,
    "생존자(여자)": 99237.0
  },
  "35": {
    "기대여명(전체) (년)": 49.3,
    "기대여명(남자) (년)": 46.4,
    "기대여명(여자) (년)": 52.1,
    "사망확률(전체)": 0.00063,
    "사망확률(남자)": 0.00078,
    "사망확률(여자)": 0.00048,
    "생존자(전체)": 98808.0,
    "생존자(남자)": 98592.0,
    "생존자(여자)": 99025.0
  },
  "40": {
    "기대여명(전체) (년)": 44.4,
    "기대여명(남자) (년)": 41.6,
    "기대여명(여자) (년)": 47.2,
    "사망확률(전체)": 0.00094,
    "사망확률(남자)": 0.00116,
    "사망확률(여자)": 0.00072,
    "생존자(전체)": 98439.0,
    "생존자(남자)": 98131.0,
    "생존자(여자)": 98749.0
  },
  "45": {
    "기대여명(전체) (년)": 39.7,
    "기대여명(남자) (년)": 36.9,
    "기대여명(여자) (년)": 42.4,
    "사망확률(전체)": 0.00134,
    "사망확률(남자)": 0.00172,
    "사망확률(여자)": 0.00096,
    "생존자(전체)": 97903.0,
    "생존자(남자)": 97457.0,
    "생존자(여자)": 98350.0
  },
  "50": {
    "기대여명(전체) (년)": 35.0,
    "기대여명(남자) (년)": 32.3,
    "기대여명(여자) (년)": 37.6,
    "사망확률(전체)": 0.00201,
    "사망확률(남자)": 0.00276,
    "사망확률(여자)": 0.00126,
    "생존자(전체)": 97132.0,
    "생존자(남자)": 96457.0,
    "생존자(여자)": 97807.0
  },
  "55": {
    "기대여명(전체) (년)": 30.4,
    "기대여명(남자) (년)": 27.8,
    "기대여명(여자) (년)": 32.9,
    "사망확률(전체)": 0.00305,
    "사망확률(남자)": 0.0043,
    "사망확률(여자)": 0.00183,
    "생존자(전체)": 95983.0,
    "생존자(남자)": 94873.0,
    "생존자(여자)": 97094.0
  },
  "60": {
    "기대여명(전체) (년)": 25.9,
    "기대여명(남자) (년)": 23.4,
    "기대여명(여자) (년)": 28.2,
    "사망확률(전체)": 0.00431,
    "사망확률(남자)": 0.00637,
    "사망확률(여자)": 0.00233,
    "생존자(전체)": 94300.0,
    "생존자(남자)": 92469.0,
    "생존자(여자)": 96133.0
  },
  "65": {
    "기대여명(전체) (년)": 21.5,
    "기대여명(남자) (년)": 19.2,
    "기대여명(여자) (년)": 23.6,
    "사망확률(전체)": 0.00647,
    "사망확률(남자)": 0.00966,
    "사망확률(여자)": 0.00348,
    "생존자(전체)": 91902.0,
    "생존자(남자)": 89007.0,
    "생존자(여자)": 94798.0
  },
  "70": {
    "기대여명(전체) (년)": 17.2,
    "기대여명(남자) (년)": 15.2,
    "기대여명(여자) (년)": 19.0,
    "사망확률(전체)": 0.01072,
    "사망확률(남자)": 0.01572,
    "사망확률(여자)": 0.00619,
    "생존자(전체)": 88325.0,
    "생존자(남자)": 83898.0,
    "생존자(여자)": 92754.0
  },
  "75": {
    "기대여명(전체) (년)": 13.2,
    "기대여명(남자) (년)": 11.6,
    "기대여명(여자) (년)": 14.7,
    "사망확률(전체)": 0.01867,
    "사망확률(남자)": 0.02679,
    "사망확률(여자)": 0.01175,
    "생존자(전체)": 82462.0,
    "생존자(남자)": 75905.0,
    "생존자(여자)": 89020.0
  },
  "80": {
    "기대여명(전체) (년)": 9.7,
    "기대여명(남자) (년)": 8.3,
    "기대여명(여자) (년)": 10.7,
    "사망확률(전체)": 0.03821,
    "사망확률(남자)": 0.0521,
    "사망확률(여자)": 0.02741,
    "생존자(전체)": 72729.0,
    "생존자(남자)": 63640.0,
    "생존자(여자)": 81819.0
  },
  "85": {
    "기대여명(전체) (년)": 6.8,
    "기대여명(남자) (년)": 5.7,
    "기대여명(여자) (년)": 7.5,
    "사망확률(전체)": 0.07574,
    "사망확률(남자)": 0.09971,
    "사망확률(여자)": 0.05991,
    "생존자(전체)": 55734.0,
    "생존자(남자)": 44318.0,
    "생존자(여자)": 67150.0
  },
  "90": {
    "기대여명(전체) (년)": 4.7,
    "기대여명(남자) (년)": 3.9,
    "기대여명(여자) (년)": 5.0,
    "사망확률(전체)": 0.13671,
    "사망확률(남자)": 0.17351,
    "사망확률(여자)": 0.11794,
    "생존자(전체)": 33235.0,
    "생존자(남자)": 22445.0,
    "생존자(여자)": 44024.0
  },
  "95": {
    "기대여명(전체) (년)": 3.2,
    "기대여명(남자) (년)": 2.6,
    "기대여명(여자) (년)": 3.4,
    "사망확률(전체)": 0.22354,
    "사망확률(남자)": 0.2748,
    "사망확률(여자)": 0.20559,
    "생존자(전체)": 13109.0,
    "생존자(남자)": 6799.0,
    "생존자(여자)": 19419.0
  },
  "2": {
    "기대여명(전체) (년)": 81.7,
    "기대여명(남자) (년)": 78.8,
    "기대여명(여자) (년)": 84.6,
    "사망확률(전체)": 0.00015,
    "사망확률(남자)": 0.00015,
    "사망확률(여자)": 0.00014,
    "생존자(전체)": 99740.0,
    "생존자(남자)": 99709.0,
    "생존자(여자)": 99772.0
  },
  "3": {
    "기대여명(전체) (년)": 80.7,
    "기대여명(남자) (년)": 77.8,
    "기대여명(여자) (년)": 83.6,
    "사망확률(전체)": 0.00012,
    "사망확률(남자)": 0.00011,
    "사망확률(여자)": 0.00013,
    "생존자(전체)": 99725.0,
    "생존자(남자)": 99694.0,
    "생존자(여자)": 99758.0
  },
  "4": {
    "기대여명(전체) (년)": 79.7,
    "기대여명(남자) (년)": 76.8,
    "기대여명(여자) (년)": 82.6,
    "사망확률(전체)": 0.0001,
    "사망확률(남자)": 0,
    "사망확률(여자)": 0.00011,
    "생존자(전체)": 99713.0,
    "생존자(남자)": 99683.0,
    "생존자(여자)": 99745.0
  },
  "6": {
    "기대여명(전체) (년)": 77.7,
    "기대여명(남자) (년)": 74.8,
    "기대여명(여자) (년)": 80.7,
    "사망확률(전체)": 0,
    "사망확률(남자)": 0,
    "사망확률(여자)": 0,
    "생존자(전체)": 99694.0,
    "생존자(남자)": 99664.0,
    "생존자(여자)": 99725.0
  },
  "7": {
    "기대여명(전체) (년)": 76.8,
    "기대여명(남자) (년)": 73.8,
    "기대여명(여자) (년)": 79.7,
    "사망확률(전체)": 0,
    "사망확률(남자)": 0,
    "사망확률(여자)": 0,
    "생존자(전체)": 99686.0,
    "생존자(남자)": 99655.0,
    "생존자(여자)": 99718.0
  },
  "8": {
    "기대여명(전체) (년)": 75.8,
    "기대여명(남자) (년)": 72.9,
    "기대여명(여자) (년)": 78.7,
    "사망확률(전체)": 0,
    "사망확률(남자)": 0,
    "사망확률(여자)": 0,
    "생존자(전체)": 99679.0,
    "생존자(남자)": 99647.0,
    "생존자(여자)": 99711.0
  },
  "9": {
    "기대여명(전체) (년)": 74.8,
    "기대여명(남자) (년)": 71.9,
    "기대여명(여자) (년)": 77.7,
    "사망확률(전체)": 0,
    "사망확률(남자)": 0,
    "사망확률(여자)": 0,
    "생존자(전체)": 99672.0,
    "생존자(남자)": 99641.0,
    "생존자(여자)": 99705.0
  },
  "11": {
    "기대여명(전체) (년)": 72.8,
    "기대여명(남자) (년)": 69.9,
    "기대여명(여자) (년)": 75.7,
    "사망확률(전체)": 0,
    "사망확률(남자)": 0,
    "사망확률(여자)": 0,
    "생존자(전체)": 99659.0,
    "생존자(남자)": 99628.0,
    "생존자(여자)": 99692.0
  },
  "12": {
    "기대여명(전체) (년)": 71.8,
    "기대여명(남자) (년)": 68.9,
    "기대여명(여자) (년)": 74.7,
    "사망확률(전체)": 0.0001,
    "사망확률(남자)": 0.0001,
    "사망확률(여자)": 0.0001,
    "생존자(전체)": 99652.0,
    "생존자(남자)": 99621.0,
    "생존자(여자)": 99684.0
  },
  "13": {
    "기대여명(전체) (년)": 70.8,
    "기대여명(남자) (년)": 67.9,
    "기대여명(여자) (년)": 73.7,
    "사망확률(전체)": 0.00013,
    "사망확률(남자)": 0.00013,
    "사망확률(여자)": 0.00012,
    "생존자(전체)": 99642.0,
    "생존자(남자)": 99611.0,
    "생존자(여자)": 99673.0
  },
  "14": {
    "기대여명(전체) (년)": 69.8,
    "기대여명(남자) (년)": 66.9,
    "기대여명(여자) (년)": 72.7,
    "사망확률(전체)": 0.00016,
    "사망확률(남자)": 0.00016,
    "사망확률(여자)": 0.00015,
    "생존자(전체)": 99629.0,
    "생존자(남자)": 99598.0,
    "생존자(여자)": 99661.0
  },
  "16": {
    "기대여명(전체) (년)": 67.8,
    "기대여명(남자) (년)": 64.9,
    "기대여명(여자) (년)": 70.7,
    "사망확률(전체)": 0.00022,
    "사망확률(남자)": 0.00023,
    "사망확률(여자)": 0.0002,
    "생존자(전체)": 99595.0,
    "생존자(남자)": 99563.0,
    "생존자(여자)": 99628.0
  },
  "17": {
    "기대여명(전체) (년)": 66.8,
    "기대여명(남자) (년)": 63.9,
    "기대여명(여자) (년)": 69.7,
    "사망확률(전체)": 0.00024,
    "사망확률(남자)": 0.00027,
    "사망확률(여자)": 0.00021,
    "생존자(전체)": 99573.0,
    "생존자(남자)": 99539.0,
    "생존자(여자)": 99608.0
  },
  "18": {
    "기대여명(전체) (년)": 65.9,
    "기대여명(남자) (년)": 62.9,
    "기대여명(여자) (년)": 68.8,
    "사망확률(전체)": 0.00026,
    "사망확률(남자)": 0.0003,
    "사망확률(여자)": 0.00022,
    "생존자(전체)": 99549.0,
    "생존자(남자)": 99513.0,
    "생존자(여자)": 99586.0
  },
  "19": {
    "기대여명(전체) (년)": 64.9,
    "기대여명(남자) (년)": 62.0,
    "기대여명(여자) (년)": 67.8,
    "사망확률(전체)": 0.00028,
    "사망확률(남자)": 0.00034,
    "사망확률(여자)": 0.00023,
    "생존자(전체)": 99523.0,
    "생존자(남자)": 99483.0,
    "생존자(여자)": 99564.0
  },
  "21": {
    "기대여명(전체) (년)": 62.9,
    "기대여명(남자) (년)": 60.0,
    "기대여명(여자) (년)": 65.8,
    "사망확률(전체)": 0.00034,
    "사망확률(남자)": 0.00042,
    "사망확률(여자)": 0.00026,
    "생존자(전체)": 99464.0,
    "생존자(남자)": 99412.0,
    "생존자(여자)": 99517.0
  },
  "22": {
    "기대여명(전체) (년)": 61.9,
    "기대여명(남자) (년)": 59.0,
    "기대여명(여자) (년)": 64.8,
    "사망확률(전체)": 0.00036,
    "사망확률(남자)": 0.00045,
    "사망확률(여자)": 0.00027,
    "생존자(전체)": 99430.0,
    "생존자(남자)": 99370.0,
    "생존자(여자)": 99491.0
  },
  "23": {
    "기대여명(전체) (년)": 60.9,
    "기대여명(남자) (년)": 58.1,
    "기대여명(여자) (년)": 63.8,
    "사망확률(전체)": 0.00038,
    "사망확률(남자)": 0.00047,
    "사망확률(여자)": 0.0003,
    "생존자(전체)": 99394.0,
    "생존자(남자)": 99326.0,
    "생존자(여자)": 99464.0
  },
  "24": {
    "기대여명(전체) (년)": 60.0,
    "기대여명(남자) (년)": 57.1,
    "기대여명(여자) (년)": 62.9,
    "사망확률(전체)": 0.0004,
    "사망확률(남자)": 0.00048,
    "사망확률(여자)": 0.00032,
    "생존자(전체)": 99356.0,
    "생존자(남자)": 99279.0,
    "생존자(여자)": 99435.0
  },
  "100": {
    "기대여명(전체) (년)": 2.2,
    "기대여명(남자) (년)": 1.8,
    "기대여명(여자) (년)": 2.3,
    "사망확률(전체)": 0.33105,
    "사망확률(남자)": 0.39635,
    "사망확률(여자)": 0.31525,
    "생존자(전체)": 2794.0,
    "생존자(남자)": 965.0,
    "생존자(여자)": 4622.0
  }
};

// 연령별 데이터 조회 함수 (개선된 버전)
function getLifeTableDataByAge(age) {
    // 정확한 나이가 있으면 반환
    if (completeLifeTable2023[age.toString()]) {
        return completeLifeTable2023[age.toString()];
    }
    
    // 가장 가까운 나이대 찾기 (선형 보간 적용)
    const ages = Object.keys(completeLifeTable2023).map(Number).sort((a, b) => a - b);
    let lowerAge = ages[0];
    let upperAge = ages[ages.length - 1];
    
    // 입력된 나이보다 작거나 같은 가장 큰 나이 찾기
    for (const ageKey of ages) {
        if (ageKey <= age) {
            lowerAge = ageKey;
        } else {
            upperAge = ageKey;
            break;
        }
    }
    
    // 정확히 일치하는 나이가 있으면 반환
    if (lowerAge === age) {
        return completeLifeTable2023[lowerAge.toString()];
    }
    
    // 범위를 벗어나면 가장 가까운 데이터 반환
    if (age < ages[0]) {
        return completeLifeTable2023[ages[0].toString()];
    }
    if (age > ages[ages.length - 1]) {
        return completeLifeTable2023[ages[ages.length - 1].toString()];
    }
    
    // 선형 보간으로 중간값 계산
    const lowerData = completeLifeTable2023[lowerAge.toString()];
    const upperData = completeLifeTable2023[upperAge.toString()];
    
    if (!upperData || lowerAge === upperAge) {
        return lowerData;
    }
    
    const ratio = (age - lowerAge) / (upperAge - lowerAge);
    
    // 보간된 데이터 생성
    const interpolatedData = {};
    for (const key in lowerData) {
        if (typeof lowerData[key] === 'number' && typeof upperData[key] === 'number') {
            interpolatedData[key] = lowerData[key] + (upperData[key] - lowerData[key]) * ratio;
        } else {
            interpolatedData[key] = lowerData[key]; // 숫자가 아닌 경우 하위 데이터 사용
        }
    }
    
    return interpolatedData;
}

// 성별별 데이터 조회 함수
function getLifeExpectancy(age, gender) {
    const data = getLifeTableDataByAge(age);
    if (!data) return null;
    
    switch(gender) {
        case 'male':
            return {
                lifeExpectancy: data["기대여명(남자) (년)"],
                deathProbability: data["사망확률(남자)"],
                survivors: data["생존자(남자)"]
            };
        case 'female':
            return {
                lifeExpectancy: data["기대여명(여자) (년)"],
                deathProbability: data["사망확률(여자)"],
                survivors: data["생존자(여자)"]
            };
        default:
            return {
                lifeExpectancy: data["기대여명(전체) (년)"],
                deathProbability: data["사망확률(전체)"],
                survivors: data["생존자(전체)"]
            };
    }
}

// 데이터 검증 함수
function validateCompleteLifeTable2023() {
    const requiredAges = [0, 1, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55, 60, 65, 70, 75, 80, 85, 90, 95, 100];
    
    for (const age of requiredAges) {
        if (!completeLifeTable2023[age.toString()]) {
            console.warn(`${age}세 데이터가 없습니다.`);
        }
    }
    
    console.log('2023년 완전생명표 데이터 검증 완료');
    return true;
}

// 페이지 로드 시 데이터 검증 실행
document.addEventListener('DOMContentLoaded', function() {
    validateCompleteLifeTable2023();
});